pro find_despin
  if 0 then begin
    i=10L*30
    while 1 do begin
      img=read_png(string(format='(%"C:\\Users\\jeppesen\\Videos\\Space\\SDO movies\\36.286\\Fwd\\Frames\\frame%05d.png")',i))
      tv,img,true=1
      plots,[0,720],[240,240],/device
      cursor,x,y,/device,/up
      if !mouse.button eq 4 then print,i
      if !mouse.button eq 2 then break
      i=i+1
    end
  end else if 0 then begin
    st1=[ 350, $
 396, $
 423, $
 444, $
 463, $
 486, $
 510, $
 535, $
 560, $
 586, $
 614, $
 645, $
 675, $
 704, $
 733, $
 759, $
 784, $
 807, $
 829, $
 849, $
 868, $
 886, $
 904, $
 921, $
 938, $
 954, $
 969, $
 984, $
 999, $
1014, $
1028, $
1042, $
1056, $
1069, $
1082, $
1095, $
1107, $
1120, $
1132, $
1143, $
1155, $
1166, $
1177, $
1188, $
1199, $
1209, $
1220, $
1230, $
1240, $
1250, $
1260, $
1270, $
1281, $
1290, $
1300, $
1310, $
1319, $
1328, $
1338, $
1347, $
1356, $
1365, $
1374, $
1383, $
1391, $
1400, $
1409, $
1417, $
1426, $
1435, $
1443, $
1452, $
1460, $
1468, $
1477, $
1485, $
1493, $
1501, $
1509, $
1517, $
1525, $
1533, $
1541, $
1549, $
1557, $
1565, $
1572, $
1580, $
1588, $
1596, $
1603, $
1611, $
1618, $
1626, $
1633, $
1641, $
1648, $
1655, $
1662, $
1670, $
1677, $
1684, $
1691, $
1699, $
1706, $
1713, $
1721, $
1728, $
1735, $
1743, $
1750, $
1757, $
1765, $
1772, $
1779, $
1787, $
1794, $
1801, $
1808, $
1815, $
1823, $
1830, $
1837, $
1844, $
1851, $
1859, $
1866, $
1873, $
1880, $
1888, $
1895, $
1902, $
1909, $
1917, $
1925, $
1932, $
1939, $
1946, $
1954, $
1961, $
1968, $
1975, $
1982, $
1990, $
1997, $
2004, $
2011, $
2018, $
2026, $
2033, $
2040, $
2048, $
2055, $
2062, $
2069, $
2077, $
2084, $
2091, $
2098, $
2106, $
2113, $
2120, $
2127, $
2135, $
2142, $
2149, $
2156, $
2164, $
2171, $
2178, $
2185, $
2193, $
2200, $
2207, $
2214, $
2222, $
2229, $
2236, $
2243, $
2251, $
2258, $
2265, $
2272, $
2280, $
2287, $
2294, $
2301, $
2309, $
2316, $
2323, $
2330, $
2338, $
2345, $
2352, $
2359, $
2366, $
2374, $
2381, $
2388, $
2395, $
2403, $
2410, $
2417, $
2424, $
2432, $
2439, $
2446, $
2453, $
2461, $
2468, $
2475, $
2482, $
2490, $
2497, $
2504, $
2511, $
2518, $
2526, $
2533, $
2540, $
2547, $
2555, $
2563, $
2570, $
2579, $
2607  $
] 
    for j=125,n_elements(st1)-1 do begin
      i1=st1[j]
      i0=i1-1
      img1=read_png(string(format='(%"C:\\Users\\jeppesen\\Videos\\Space\\SDO movies\\36.286\\Fwd\\Frames\\frame%05d.png")',i1))
      img0=read_png(string(format='(%"C:\\Users\\jeppesen\\Videos\\Space\\SDO movies\\36.286\\Fwd\\Frames\\frame%05d.png")',i0))
      img=img1/2+img0/2
      tv,true=1,img
      plots,[0,720],[240,240],/device
      fudge=0.0
      read,fudge
      print,float(i0)+fudge/10
;      stop
    end
  end else if 1 then begin
    st2=[     349.5, $
     395.6, $
     422.9, $
     443.5, $
     462.8, $
     485.5, $
     509.7, $
     534.5, $
     559.6, $
     585.5, $
     613.6, $
     644.1, $
     674.4, $
     703.9, $
     732.2, $
     758.5, $
     783.5, $
     806.5, $
     828.2, $
     848.5, $
     867.5, $
     885.9, $
     903.5, $
     920.7, $
     937.2, $
     953.2, $
     968.8, $
     983.9, $
     999.0, $
    1013.5, $
    1027.6, $
    1041.6, $
    1055.2, $
    1068.6, $
    1081.7, $
    1094.3, $
    1107.0, $
    1119.4, $
    1131.3, $
    1142.9, $
    1154.5, $
    1165.7, $
    1176.8, $
    1187.7, $
    1198.5, $
    1209.0, $
    1219.4, $
    1229.7, $
    1239.8, $
    1249.9, $
    1259.8, $
    1269.7, $
    1280.3, $
    1290.0, $
    1299.8, $
    1309.1, $
    1318.7, $
    1327.8, $
    1337.1, $
    1346.2, $
    1355.3, $
    1364.3, $
    1373.3, $
    1382.2, $
    1391.0, $
    1399.8, $
    1408.3, $
    1417.0, $
    1425.6, $
    1434.2, $
    1442.7, $
    1451.1, $
    1459.5, $
    1467.8, $
    1476.1, $
    1484.3, $
    1492.5, $
    1500.6, $
    1508.7, $
    1516.8, $
    1524.9, $
    1532.9, $
    1540.9, $
    1548.8, $
    1556.6, $
    1564.4, $
    1572.0, $
    1579.6, $
    1587.3, $
    1595.1, $
    1602.8, $
    1610.4, $
    1617.8, $
    1625.3, $
    1632.8, $
    1640.2, $
    1647.4, $
    1654.6, $
    1661.8, $
    1669.2, $
    1676.4, $
    1683.6, $
    1691.0, $
    1698.2, $
    1705.6, $
    1712.9, $
    1720.2, $
    1727.6, $
    1734.9, $
    1742.3, $
    1749.6, $
    1756.9, $
    1764.3, $
    1771.5, $
    1778.8, $
    1786.0, $
    1793.3, $
    1800.6, $
    1807.8, $
    1815.1, $
    1822.3, $
    1829.5, $
    1836.8, $
    1843.9, $
    1851.1, $
    1858.4, $
    1865.6, $
    1872.8, $
    1880.0, $
    1887.2, $
    1894.4, $
    1901.6, $
    1908.8, $
    1917.0, $
    1924.2, $
    1931.4, $
    1938.6, $
    1945.7, $
    1953.1, $
    1960.3, $
    1967.6, $
    1974.7, $
    1982.0, $
    1989.2, $
    1996.5, $
    2003.6, $
    2010.9, $
    2018.1, $
    2025.4, $
    2032.6, $
    2039.8, $
    2047.1, $
    2054.4, $
    2061.6, $
    2068.8, $
    2076.1, $
    2083.4, $
    2090.6, $
    2097.8, $
    2105.2, $
    2112.4, $
    2119.6, $
    2126.8, $
    2134.2, $
    2141.4, $
    2148.6, $
    2155.8, $
    2163.1, $
    2170.4, $
    2177.6, $
    2184.8, $
    2192.1, $
    2199.4, $
    2206.6, $
    2213.8, $
    2221.1, $
    2228.4, $
    2235.6, $
    2242.8, $
    2250.1, $
    2257.3, $
    2264.6, $
    2271.8, $
    2279.1, $
    2286.3, $
    2293.5, $
    2300.7, $
    2308.0, $
    2315.2, $
    2322.5, $
    2329.8, $
    2337.0, $
    2344.3, $
    2351.6, $
    2358.7, $
    2366.0, $
    2373.3, $
    2380.5, $
    2387.7, $
    2395.0, $
    2402.3, $
    2409.5, $
    2416.7, $
    2424.0, $
    2431.3, $
    2438.5, $
    2445.7, $
    2453.0, $
    2460.3, $
    2467.5, $
    2474.7, $
    2481.9, $
    2489.1, $
    2496.4, $
    2503.7, $
    2510.9, $
    2518.0, $
    2525.2, $
    2532.5, $
    2539.7, $
    2547.0, $
    2554.0, $
    2562.2, $
    2570.0, $
    2579.0, $
    2607.0  $
    ]
    th2=!dpi*2d*dindgen(n_elements(st2))+!dpi*2d/3d
    f=findgen(max(st2)-min(st2))+min(st2)
    th=interpol(th2,st2,f)
    mask=read_png("C:\Users\jeppesen\Desktop\rmask.png")
    stop
    erase
    for j=0,n_elements(f)-1 do begin
      i=f[j]
      img1=read_png(string(format='(%"C:\\Users\\jeppesen\\Videos\\Space\\SDO movies\\36.286\\Aft\\Frames\\frame%05d.png")',i))
      r=bytarr(1440,960)
      r[0:719,0:479]=img1[0,*,*]
      g=bytarr(1440,960)
      g[0:719,0:479]=img1[1,*,*]
      b=bytarr(1440,960)
      b[0:719,0:479]=img1[2,*,*]
      w=bytarr(1440,960)
      w[0:719,0:479]=mask eq 0
      s=sin(-th[j])
      c=cos(-th[j])
      t1=[[1d,0,-22],[0,1,-230],[0,0,1]]
      r1=[[c,s,0],[-s,c,0],[0,0,1]]
      t2=[[1d,0,720],[0,1,480],[0,0,1]]
      m=invert(t2 ## r1 ## t1)
      r=eve_affine_matrix(r,m,missing=0)
      g=eve_affine_matrix(g,m,missing=0)
      b=eve_affine_matrix(b,m,missing=0)
      w=where(eve_affine_matrix(w,m,missing=0))
      if n_elements(rot_img) eq 0 then begin
        rot_img=[[[r]],[[g]],[[b]]]
      end else begin
        rot_img=rot_img*94/100
        rot_r=rot_img[*,*,0]
        rot_r[w]=r[w]
        rot_g=rot_img[*,*,1]
        rot_g[w]=g[w]
        rot_b=rot_img[*,*,2]
        rot_b[w]=b[w]
        rot_img=[[[rot_r]],[[rot_g]],[[rot_b]]]
      end
      tv,true=3,rot_img
      write_png,string(format='(%"C:\\Users\\jeppesen\\Videos\\Space\\SDO movies\\36.286\\Despin\\Frames\\frame%05d.png")',j),tvrd(0,0,1440,960,true=1)
;      stop
    end
  end
end